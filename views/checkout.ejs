<!DOCTYPE html>
<html lang="en" class="font-poppins">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Balthazar&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
    <link rel="stylesheet" href="/css/style.css" />
    <script
      src="https://kit.fontawesome.com/2e5b228621.js"
      crossorigin="anonymous"
    ></script>
    <!-- <script defer src="/js/design.js"></script> -->
    <script defer src="/js/checkout.js"></script>
    <title><%= title %></title>
  </head>
  <body class="checkout-body">
    <header
      class="flex justify-between items-center py-5 px-8 mq850:px-10 bg-white"
    >
      <% if (cart.length > 0) { %>

      <button
        id="scrollBottomBtn"
        class="flex lg:hidden px-3 justify-center order-3 py-1.5 text-sm font-semibold text-gray-600"
        onclick="scrollToBottom()"
      >
        Betala nu
        <i class="fa-solid fa-arrow-down text-base ml-2"></i>
      </button>
      <% } %>
      <a href="/" class="w-32 min-w-32 max-w-32 z-50">
        <svg class="" viewBox="0 0 342 35" xmlns="http://www.w3.org/2000/svg">
          <path
            fill="currentColor"
            d="M0 .1a9.7 9.7 0 0 0 7 7h11l.5.1v27.6h6.8V7.3L26 7h11a9.8 9.8 0 0 0 7-7H0zm238.6 0h-6.8v34.8H263a9.7 9.7 0 0 0 6-6.8h-30.3V0zm-52.3 6.8c3.6-1 6.6-3.8 7.4-6.9l-38.1.1v20.6h31.1v7.2h-24.4a13.6 13.6 0 0 0-8.7 7h39.9v-21h-31.2v-7zm116.2 28h6.7v-14h24.6v14h6.7v-21h-38zM85.3 7h26a9.6 9.6 0 0 0 7.1-7H78.3a9.6 9.6 0 0 0 7 7m0 13.8h26a9.6 9.6 0 0 0 7.1-7H78.3a9.6 9.6 0 0 0 7 7m0 14.1h26a9.6 9.6 0 0 0 7.1-7H78.3a9.6 9.6 0 0 0 7 7M308.5 7h26a9.6 9.6 0 0 0 7-7h-40a9.6 9.6 0 0 0 7 7"
          ></path>
        </svg>
      </a>
      <ul
        class="hidden lg:flex font-semibold items-center flex-2 order-1 text-gray-700 z-50"
      >
        <li>
          <a
            href="design/ModelS"
            class="hover:bg-gray-100 px-10 py-2 rounded transition"
            >Model S</a
          >
        </li>
        <li>
          <a
            href="design/Model3"
            class="hover:bg-gray-100 px-10 py-2 rounded transition"
            >Model 3</a
          >
        </li>
        <li>
          <a
            href="design/ModelX"
            class="hover:bg-gray-100 px-10 py-2 rounded transition"
            >Model X</a
          >
        </li>
        <li>
          <a
            href="design/ModelY"
            class="hover:bg-gray-100 px-10 py-2 rounded transition"
            >Model Y</a
          >
        </li>
      </ul>
      <div class="mq850:flex space-x-4 sm:space-x-6 text-base transition">
        <!-- Om Cart-icon så ska den vara här -->
      </div>
    </header>
    <main class="pt-10 px-3 flex flex-col lg:flex-row justify-center lg:gap-16">
      <% if (cart.length > 0) { %>
      <div class="order-2 w-full lg:w-96 pb-8 lg:pr-6 lg:pt-16 font-medium">
        <div
          class="summary p-4 lg:p-8 m-auto w-full max-w-3xl sticky top-6 lg:shadow-xl bg-white lg:border-2 lg:border-gray-50 lg:rounded"
        >
          <h1 class="mqxs:text-lg text-base font-medium pb-6">
            Beställningssammanfattning
          </h1>

          <div class="flex justify-between pb-1">
            <div class="text-gray-800">Totalsumma:</div>
            <div class="text-gray-800">
              <%= totalCartPrice.toLocaleString('sv-SE') %> kr
            </div>
          </div>
          <div class="pb-2">
            <div class="text-gray-500 text-xs">Inklusive moms</div>
          </div>

          <!-- Popdown -->
          <div>
            <form
              id="checkoutForm"
              class="mt-4 hidden bg-white pt-4 rounded border-t-2 text-sm transition font-normal"
              onsubmit="return false;"
            >
              <!-- Namn -->
              <label class="block mb-2">
                <span class="text-gray-700"
                  >För- och efternamn
                  <span class="text-red-600 text-xs">*</span></span
                >
                <input
                  type="text"
                  name="fullName"
                  value="Ron Burgundy"
                  class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                />
              </label>

              <!-- E-post -->
              <label class="block mb-2">
                <span class="text-gray-700"
                  >E-post<span class="text-red-600 text-xs"> *</span></span
                >
                <input
                  type="email"
                  name="email"
                  value="rb@channel4.com"
                  class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                />
              </label>

              <!-- Telefonnummer -->
              <label class="block mb-2">
                <span class="text-gray-700"
                  >Telefonnummer<span class="text-red-600 text-xs">
                    *</span
                  ></span
                >
                <input
                  type="tel"
                  name="phone"
                  value="070-123 45 67"
                  class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                />
              </label>

              <!-- Adress -->
              <label class="block mb-2">
                <span class="text-gray-700"
                  >Adress<span class="text-red-600 text-xs"> *</span></span
                >
                <input
                  type="text"
                  name="address"
                  value="Baxterstreet 4"
                  class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                />
              </label>

              <!-- Postnummer -->
              <label class="block mb-2">
                <span class="text-gray-700"
                  >Postnummer<span class="text-red-600 text-xs"> *</span></span
                >
                <input
                  type="text"
                  name="postalCode"
                  value="101 101"
                  class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                />
              </label>

              <!-- Stad -->
              <label class="block mb-2">
                <span class="text-gray-700"
                  >Stad<span class="text-red-600 text-xs"> *</span></span
                >
                <input
                  type="text"
                  name="city"
                  value="San Diego"
                  class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                />
              </label>

              <!-- Land -->
              <label class="block mb-8">
                <span class="text-gray-700"
                  >Land<span class="text-red-600 text-xs"> *</span></span
                >
                <input
                  type="text"
                  name="country"
                  value="USA"
                  class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                />
              </label>

              <div class="hidden border-t-2 pt-6" id="card">
                <!-- Kortinnehavare -->
                <label class="block mb-2">
                  <span class="text-gray-700"
                    >Kortinnehavare
                    <span class="text-red-600 text-xs">*</span></span
                  >
                  <input
                    type="text"
                    name="cardHolder"
                    value="Ron Burgundy"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                  />
                </label>
                <!-- Kortnummer -->
                <label class="block mb-2">
                  <span class="text-gray-700"
                    >Kortnummer<span class="text-red-600 text-xs">
                      *</span
                    ></span
                  >
                  <input
                    type="text"
                    name="cardNumber"
                    value="4444 4444 4444 4444"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                  />
                </label>

                <!-- Giltighetstid -->
                <label class="block mb-2">
                  <span class="text-gray-700"
                    >Giltighetstid (MM/YY)<span class="text-red-600 text-xs">
                      *</span
                    ></span
                  >
                  <input
                    type="text"
                    name="expiry"
                    value="14/34"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                  />
                </label>

                <!-- CVC -->
                <label class="block mb-4">
                  <span class="text-gray-700"
                    >CVC<span class="text-red-600 text-xs"> *</span></span
                  >
                  <input
                    type="text"
                    name="cvc"
                    value="101"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400 tracking-wide text-sm text-gray-700"
                  />
                </label>
              </div>
              <button
                type="button"
                class="card-btn border-2 border-gray-400 px-4 py-2 text-sm rounded shadow w-full hover:border-gray-700 transition hover:text-white hover:bg-gray-700 duration-300 font-medium hidden"
                onclick="toggleCard()"
              >
                Kort
              </button>
              <button
                type="submit"
                class="mt-3 border-2 bg-blue-300 border-blue-300 text-white px-4 py-2 text-sm font-semibold rounded shadow w-full transition hidden cursor-not-allowed opacity-50"
                id="payButton"
                disabled
              >
                Betala
              </button>
            </form>
          </div>
          <!-- Popdown slutar här -->

          <button
            class="open-payment w-full mt-4 border-2 border-blue-500 bg-blue-500 text-white text-sm tracking-wide font-semibold rounded hover:bg-blue-600 hover:border-blue-600 px-4 py-2 transition"
            onclick="toggleCheckoutForm()"
          >
            Fortsätt till betalning
          </button>
          <button
            id="scrollTopBtn"
            class="lg:hidden px-3 mt-8 max-w-3xl text-sm font-semibold text-gray-600"
            onclick="scrollToTop()"
          >
            Till toppen<i class="fa-solid fa-arrow-up text-base ml-2"></i>
          </button>
        </div>
      </div>

      <% } %>

      <div id="cart-container">
        <% if (cart.length > 0) { %>
        <h1
          class="max-w-xl m-auto pb-10 font-medium pl-5 text-2xl text-center sm:text-left"
        >
          Varukorg (<%= cartItemCount %>)
        </h1>
        <% } %>

        <!-- EJS CART -->
        <% if (cart && cart.length > 0) { %> <% cart.forEach(item => { %>
        <div
          class="cart-item bg-white border-b pb-4 border-gray-100 px-4 space-y-1 w-full max-w-3xl mx-auto mb-5 flex flex-col sm:flex-row"
        >
          <div class="flex flex-1">
            <img
              class="item-image object-contain w-full"
              src="<%= item.image %>"
              alt="<%= item.model %>"
            />
          </div>
          <div class="flex flex-col flex-1 space-y-1">
            <div class="item-model text-xl text-gray-800 pb-2 font-medium">
              <%= item.model.slice(0, 5) + '\n' + item.model.slice(5) %>
              <span
                class="text-sm font-semibold float-right text-gray-500 hover:text-gray-900 border-b-2 border-gray-200 hover:border-gray-300 transtion duration-500 py-0.5"
              >
                <button
                  class="decrement-button px-2"
                  data-config-id="<%= item.configId %>"
                >
                  <% if (item.quantity > 1) { %><i class="fa-solid fa-minus"></i
                  ><% } else { %> <i class="fa-regular fa-trash-can"></i> <% }
                  %>
                </button>
                <span class="mx-2"><%= item.quantity %></span>
                <button
                  class="increment-button px-2"
                  data-config-id="<%= item.configId %>"
                >
                  <i class="fa-solid fa-plus"></i>
                </button>
              </span>
            </div>

            <% if (item.quantity > 0) { %>

            <div class="text-xs text-gray-600">
              Kvantitet:
              <span class=" "><%= item.quantity %></span>
            </div>
            <% } %>

            <div class="text-xs text-gray-600 flex justify-between">
              <span class="break-words"> Variant: <%= item.variant %> </span>
              <span class="float-right whitespace-nowrap">
                <%= item.variantPrice.toLocaleString('sv-SE') %> kr</span
              >
            </div>
            <div class="text-xs text-gray-600 flex justify-between">
              <span class="break-words">Autopilot: <%= item.autopilot %></span>
              <span class="ml-4 whitespace-nowrap">
                <%= item.autopilotPrice > 0 ? ' + ' +
                item.autopilotPrice.toLocaleString('sv-SE') + ' kr' : '✔' %>
              </span>
            </div>
            <div class="text-xs text-gray-600">
              Hjul: <%= item.wheel %>
              <span class="float-right"
                ><%= item.wheelPrice > 0 ? ' + ' +
                item.wheelPrice.toLocaleString('sv-SE') + ' kr' : '✔' %></span
              >
            </div>
            <div class="text-xs text-gray-600">
              Dragkraft: <%= item.traction %>
              <span class="float-right"
                ><%= item.tractionPrice > 0 ? item.tractionPrice + ' kr' : '✔'
                %></span
              >
            </div>
            <div class="text-xs text-gray-600">
              Färg: <%= item.color %>
              <span class="float-right">
                <%= item.colorPrice > 0 ? '+ ' +
                item.colorPrice.toLocaleString('sv-SE') + ' kr' : '✔' %>
              </span>
            </div>

            <% if (item.quantity > 1) { %>
            <div class="text-xs text-gray-600">
              Styckpris:
              <span class="float-right">
                <%= item.totalPrice.toLocaleString('sv-SE') %> kr
              </span>
            </div>
            <% } %>

            <div class="text-sm font-medium text-gray-800">
              Sammanlagt:
              <span class="float-right border-b border-gray-700">
                <%= (item.totalPrice * item.quantity).toLocaleString('sv-SE') %>
                kr
              </span>
            </div>
          </div>
        </div>
        <% }); %> <% } else { %>
        <div
          class="absolute inset-0 flex flex-col items-center text-2xl sm:text-3xl justify-center text-gray-500"
        >
          Din varukorg är tom.
          <a
            href="/"
            class="w-64 mt-10 bg-blue-500 text-center text-white text-sm tracking-wide font-semibold rounded hover:bg-blue-600 px-4 py-3 transition"
          >
            Fortsätt handla
          </a>
        </div>
        <% } %>
      </div>
    </main>

    <div id="fetchLoader" class="loader">
      <div class="spinner">
        <div class="spinner-inner">
          <img src="/images/loaderLogo.webp" alt="Logo" class="spinner-logo" />
        </div>
      </div>
    </div>
  </body>
</html>
